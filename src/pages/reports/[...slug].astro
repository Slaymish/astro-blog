---
import { getCollection, getEntry } from 'astro:content';
import Layout from '../../components/Layout.astro';
export const prerender = true;

export async function getStaticPaths() {
  const reports = await getCollection('reports');
  return reports.map(r => {
    const slug = r.id.replace(/\.(md|mdx)$/, '');
    return { params: { slug } };
  });
}

const slug = Astro.params.slug as string;

const report = await getEntry('reports', slug);
if (!report) {
  throw new Error(`Report not found: ${slug}`);
}

const data = report.data as any;
const html = report.rendered?.html || '';
---

<Layout title={data.title}>
  <main>
    <article>
      <h1>{data.title}</h1>
      <div class="meta">
        <time>{new Date(data.pubDate).toLocaleDateString()}</time>
      </div>

      {data.pdfPath && (
        <div class="pdf-container">
          <iframe src={data.pdfPath} width="100%" height="800px" style="border:none;" />
        </div>
      )}

      {data.pdfPath && (
        <a href={data.pdfPath} download class="download-btn">
          Download PDF Report
        </a>
      )}

      {html && (
        <div class="prose prose-invert max-w-none" set:html={html} />
      )}
    </article>
  </main>
</Layout>

<style>
  .pdf-container {
    max-width: 100%;
    margin: 2rem 0;
  }
  
  .download-btn {
    display: inline-block;
    padding: 0.5rem 1rem;
    background: var(--accent);
    color: white;
    text-decoration: none;
    border-radius: 4px;
    margin: 1rem 0;
  }
</style>

---
import { getCollection, type CollectionEntry } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

export async function getStaticPaths() {
  const reports = await getCollection('reports') as CollectionEntry<'reports'>[];
  return reports.map((r) => ({
    params: { slug: r.slug },
    props: { report: r }
  }));
}

// tell TS to trust us here:
const report = Astro.props.report as any;
const data = report.data as any;
const { Content } = await report.render();
---

<Layout title={data.title}>
  <main>
    <article>
      <h1>{data.title}</h1>
      <div class="meta">
        <time>{new Date(data.pubDate).toLocaleDateString()}</time>
      </div>

      {data.pdfPath && (
        <div class="pdf-container">
          <iframe src={data.pdfPath} width="100%" height="800px" style="border:none;" />
        </div>
      )}

      {data.pdfPath && (
        <a href={data.pdfPath} download class="download-btn">
          Download PDF Report
        </a>
      )}

      <Content />
    </article>
  </main>
</Layout>

<style>
  .pdf-container {
    max-width: 100%;
    margin: 2rem 0;
  }
  
  .download-btn {
    display: inline-block;
    padding: 0.5rem 1rem;
    background: var(--accent);
    color: white;
    text-decoration: none;
    border-radius: 4px;
    margin: 1rem 0;
  }
</style>

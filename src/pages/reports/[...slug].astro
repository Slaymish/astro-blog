---
import { getCollection, getEntry } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

export async function getStaticPaths() {
  const reports = await getCollection('reports');
  return reports.map(r => {
    const slug = r.id.replace(/\.(md|mdx)$/, '');
    return { params: { slug: slug.split('/') } };
  });
}

const rawSlug = Astro.params.slug;
const slug = Array.isArray(rawSlug) ? rawSlug.join('/') : rawSlug;
const report = await getEntry('reports', slug);
if (!report) {
  throw new Error(`Report not found: ${slug}`);
}
const data = report.data as any;
const { Content } = await report.render();
---

<Layout title={data.title}>
  <main>
    <article>
      <h1>{data.title}</h1>
      <div class="meta">
        <time>{new Date(data.pubDate).toLocaleDateString()}</time>
      </div>

      {data.pdfPath && (
        <div class="pdf-container">
          <iframe src={data.pdfPath} width="100%" height="800px" style="border:none;" />
        </div>
      )}

      {data.pdfPath && (
        <a href={data.pdfPath} download class="download-btn">
          Download PDF Report
        </a>
      )}

      <Content />
    </article>
  </main>
</Layout>

<style>
  .pdf-container {
    max-width: 100%;
    margin: 2rem 0;
  }
  
  .download-btn {
    display: inline-block;
    padding: 0.5rem 1rem;
    background: var(--accent);
    color: white;
    text-decoration: none;
    border-radius: 4px;
    margin: 1rem 0;
  }
</style>

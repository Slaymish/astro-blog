---
// Scroll Progress Indicator
---

<div id="scroll-progress"></div>

<style>
  #scroll-progress {
    position: fixed;
    top: 0;
    left: 0;
    width: 0%;
    height: 2px;
    background: linear-gradient(90deg, var(--color-primary-500), var(--color-accent-500), var(--color-accent2-500));
    z-index: 1000;
    transition: width 0.1s ease;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  }

  #scroll-progress::after {
    content: '';
    position: absolute;
    right: 0;
    top: 0;
    width: 8px;
    height: 100%;
    background: var(--color-primary-400);
    border-radius: 0 1px 1px 0;
    box-shadow: 0 0 4px var(--color-primary-500);
    opacity: 0.8;
  }
</style>

<script is:inline>
  (function() {
    let updateProgress = null;

    function initScrollProgress() {
      const progressBar = document.getElementById('scroll-progress');

      updateProgress = function() {
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        const scrollHeight = document.documentElement.scrollHeight - window.innerHeight;
        const progress = (scrollTop / scrollHeight) * 100;

        if (progressBar) {
          progressBar.style.width = Math.min(progress, 100) + '%';
        }
      };

      window.addEventListener('scroll', updateProgress, { passive: true });
      updateProgress(); // Initial call

      // Return cleanup function
      return function cleanup() {
        if (updateProgress) {
          window.removeEventListener('scroll', updateProgress);
          updateProgress = null;
        }
      };
    }

    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => {
        window.__scrollProgressCleanup = initScrollProgress();
      });
    } else {
      window.__scrollProgressCleanup = initScrollProgress();
    }

    // Cleanup on page navigation/unload
    window.addEventListener('beforeunload', () => {
      if (window.__scrollProgressCleanup) {
        window.__scrollProgressCleanup();
        window.__scrollProgressCleanup = null;
      }
    });
  })();
</script>

---
/**
 * GRID TILE COMPONENT
 *
 * Reusable tile component for the bento grid layout.
 * Supports different sizes and includes hover effects with arrow indicator.
 */

export interface TileProps {
  title: string;
  description: string;
  href: string;
  size?: 'square' | 'wide';
  tags?: string[];
  date?: string;
  external?: boolean;
  type?: 'post' | 'report' | string;
  typeHref?: string;
}

const {
  title,
  description,
  href,
  size = 'square',
  tags = [],
  date = '',
  external = false,
  type,
  typeHref
} = Astro.props;

const containerClass =
  size === 'wide'
    ? 'aspect-square px-1 pb-2 sm:col-span-2 sm:aspect-[2/1]'
    : 'aspect-square px-1 pb-2';
const contentClass =
  'group relative h-full w-full overflow-hidden rounded-lg tile-surface';
const cursorClass = external ? 'cursor-alias' : 'cursor-pointer';
const baseTypeLabel =
  type === 'report' ? 'Report' : type === 'post' ? 'Writing' : type === 'project' ? 'Projects' : type;
const typeLabel = baseTypeLabel ?? 'Project';
const metaParts = [typeLabel, tags[0]].filter(Boolean);
const inferredTypeHref =
  type === 'report' || type === 'post' ? '/writing' : type === 'project' ? '/projects' : undefined;
const resolvedTypeHref = typeHref ?? inferredTypeHref;
---

<article class={`grid-tile ${containerClass}`}>
  <div class={contentClass}>
    <div class="flex h-full w-full flex-col">
      <div class="flex items-center justify-between pl-4 pr-2 pt-2 text-sm tracking-tight tile-meta-text">
        <span class="py-1.5">
          {resolvedTypeHref ? (
            <a
              href={resolvedTypeHref}
              class="rounded transition-colors focus-visible:ring-4 focus-visible:ring-blue-200 focus-visible:text-neutral-500 focus-visible:underline hover:text-neutral-500 hover:underline"
            >
              {typeLabel}
            </a>
          ) : (
            <span>{typeLabel}</span>
          )}
          {metaParts[1] && (
            <>
              &nbsp;Â·&nbsp;{metaParts[1]}
            </>
          )}
        </span>
        <a
          href={href}
          target={external ? '_blank' : undefined}
          rel={external ? 'noopener noreferrer' : undefined}
          class={`flex h-8 w-8 items-center justify-center rounded-full transition-colors focus-visible:ring-4 focus-visible:ring-blue-200 group-focus-within:bg-white group-focus-within:text-neutral-900 group-hover:bg-white group-hover:text-neutral-900 ${cursorClass}`}
          aria-label={external ? 'Open external link' : 'Open item'}
        >
          {external ? (
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="h-4 w-4">
              <path fill-rule="evenodd" d="M5.22 14.78a.75.75 0 001.06 0l7.22-7.22v5.69a.75.75 0 001.5 0v-7.5a.75.75 0 00-.75-.75h-7.5a.75.75 0 000 1.5h5.69l-7.22 7.22a.75.75 0 000 1.06z" clip-rule="evenodd"></path>
            </svg>
          ) : (
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="h-4 w-4">
              <path fill-rule="evenodd" d="M3 10a.75.75 0 01.75-.75h10.69l-3.22-3.22a.75.75 0 111.06-1.06l4.5 4.5a.75.75 0 010 1.06l-4.5 4.5a.75.75 0 11-1.06-1.06l3.22-3.22H3.75A.75.75 0 013 10z" clip-rule="evenodd"></path>
            </svg>
          )}
        </a>
      </div>

      <a
        href={href}
        class={`tile-link flex-1 px-5 pb-5 pt-3 ${cursorClass}`}
        target={external ? '_blank' : undefined}
        rel={external ? 'noopener noreferrer' : undefined}
        aria-label={title}
      >
        <h3 class="font-serif text-3xl font-light tracking-tight tile-title-text">{title}</h3>

        {date && (
          <span class="mt-2 mb-4 block text-sm tracking-tight tile-meta-text">{date}</span>
        )}

        {description && (
          <p class="leading-relaxed tracking-tight tile-body-text line-clamp-3 md:line-clamp-4">
            {description}
          </p>
        )}

        {tags && tags.length > 0 && (
          <div class="mt-4 flex flex-wrap gap-2 text-xs text-neutral-400">
            {tags.map((tag: string) => (
              <span class="tile-filter-tag rounded px-2 py-0.5">{tag}</span>
            ))}
          </div>
        )}
      </a>
    </div>
  </div>
</article>
